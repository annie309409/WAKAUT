{"ast":null,"code":"\"use strict\";\n\nvar _MariaDB = _interopRequireDefault(require(\"./MariaDB\"));\n\nvar _SQLs = _interopRequireDefault(require(\"./SQLs\"));\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nclass Board {\n  //게시판 목록출력\n  async select(pg, cat, note, fcname) {\n    let conn = null;\n    let rowData = null;\n    let where = '';\n    cat != 'All' ? cat = `category='${cat}'` : cat = '';\n\n    if (cat && note) {\n      where = ` and ${cat} and (title like '%테스트%' or content like '%테스트%' or u.name like '%테스트%') `;\n    } else {\n      console.log('일반');\n    }\n\n    if (fcname) where = ` and facility_name = '${fcname}' `;\n\n    try {\n      conn = await _MariaDB.default.makeConn();\n      rowData = await conn.query(_SQLs.default.board.select + where + _SQLs.default.board.select2, [pg]);\n    } catch (e) {\n      console.log(e);\n    } finally {\n      await _MariaDB.default.closeConn();\n    }\n\n    let result = {\n      'boards': rowData\n    };\n    return result;\n  } //게시글 출력\n\n\n  async selectOne(bid) {\n    let conn = null;\n    let rowData = null;\n    let params = [bid];\n\n    try {\n      conn = await _MariaDB.default.makeConn();\n      rowData = await conn.query(_SQLs.default.board.selectOne, params); //코멘트 조회 및 추가     \n\n      rowData[0].com = await conn.query(_SQLs.default.board.comments, params); //조회수 증가    \n\n      await conn.query(_SQLs.default.board.updateView, params);\n      await conn.commit();\n    } catch (e) {\n      console.log(e);\n    } finally {\n      await _MariaDB.default.closeConn();\n    }\n\n    return rowData;\n  } //코멘트 등록\n\n\n  async insertCmt(bid, uid, cmt) {\n    let conn = null;\n    let rowData = 1;\n    let params = [bid, uid, cmt];\n\n    try {\n      conn = await _MariaDB.default.makeConn();\n      await conn.query(_SQLs.default.board.insertCmt, params);\n      await conn.commit();\n    } catch (e) {\n      console.log(e);\n    } finally {\n      await _MariaDB.default.closeConn();\n    }\n\n    return rowData;\n  } //코멘트 삭제\n\n\n  async deleteCmt(cid, bid) {\n    let conn = null;\n    let rowData = null;\n    let params = [cid];\n\n    try {\n      conn = await _MariaDB.default.makeConn();\n      await conn.query(_SQLs.default.board.deleteCmt, params);\n      await conn.commit();\n    } catch (e) {\n      console.log(e);\n    } finally {\n      await _MariaDB.default.closeConn();\n    }\n\n    return rowData;\n  } //게시글 등록\n\n\n  async insert(data) {\n    let conn = null;\n    let rowData = 1;\n    let params = [data.title, data.userid, data.content, data.category, data.facility];\n\n    try {\n      conn = await _MariaDB.default.makeConn();\n      await conn.query(_SQLs.default.board.insert, params);\n      await conn.commit();\n    } catch (e) {\n      console.log(e);\n    } finally {\n      await _MariaDB.default.closeConn();\n    }\n\n    return rowData;\n  } //게시글 수정\n\n\n  async modify(data) {\n    let conn = null;\n    let rowData = 1;\n    let params = [data.title, data.content, data.category, data.facility, data.bid];\n\n    try {\n      conn = await _MariaDB.default.makeConn();\n      await conn.query(_SQLs.default.board.update, params);\n      await conn.commit();\n      rowData = 1;\n    } catch (e) {\n      console.log(e);\n    } finally {\n      await _MariaDB.default.closeConn();\n    }\n\n    return rowData;\n  } //게시글 삭제\n\n\n  async delete(bid) {\n    let conn = null;\n    let rowData = null;\n    let params = [bid];\n\n    try {\n      conn = await _MariaDB.default.makeConn();\n      await conn.query(_SQLs.default.board.deleteCmt2, params);\n      await conn.query(_SQLs.default.board.delete, params);\n      await conn.commit();\n      rowData = 1;\n    } catch (e) {\n      console.log(e);\n    } finally {\n      await _MariaDB.default.closeConn();\n    }\n\n    return rowData;\n  }\n\n}\n\nmodule.exports = Board;","map":null,"metadata":{},"sourceType":"script"}