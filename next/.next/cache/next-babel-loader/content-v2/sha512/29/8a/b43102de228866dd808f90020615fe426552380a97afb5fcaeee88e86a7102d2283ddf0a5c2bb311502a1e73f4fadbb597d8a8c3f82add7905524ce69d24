{"ast":null,"code":"\"use strict\";\n\nvar _MariaDB = _interopRequireDefault(require(\"./MariaDB\"));\n\nvar _SQLs = _interopRequireDefault(require(\"./SQLs\"));\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nclass Board {\n  //게시판 목록출력\n  async select(pg, cat, note, fcname) {\n    let conn = null;\n    let rowData = null;\n    let where = '';\n    cat != 'All' ? cat = `category='${cat}'` : cat = '';\n\n    if (cat && note) {\n      where = ` and ${cat} and (title like '%테스트%' or content like '%테스트%' or u.name like '%테스트%') `;\n    } else {\n      console.log('일반');\n    }\n\n    if (fcname) where = ` and facility_name = '${fcname}' `;\n\n    try {\n      conn = await _MariaDB.default.makeConn();\n      rowData = await conn.query(_SQLs.default.board.select + where + _SQLs.default.board.select2, [pg]);\n    } catch (e) {\n      console.log(e);\n    } finally {\n      await _MariaDB.default.closeConn();\n    }\n\n    let result = {\n      'boards': rowData\n    };\n    return result;\n  } //게시글 출력\n\n\n  async selectOne(bid) {\n    let conn = null;\n    let rowData = null;\n    let params = [bid];\n\n    try {\n      conn = await _MariaDB.default.makeConn();\n      rowData = await conn.query(_SQLs.default.board.selectOne, params); //코멘트 조회 및 추가     \n\n      rowData[0].com = await conn.query(_SQLs.default.board.comments, params); //조회수 증가    \n\n      await conn.query(_SQLs.default.board.updateView, params);\n      await conn.commit();\n    } catch (e) {\n      console.log(e);\n    } finally {\n      await _MariaDB.default.closeConn();\n    }\n\n    return rowData;\n  } //코멘트 등록\n\n\n  async insertCmt(bid, uid, cmt) {\n    let conn = null;\n    let rowData = 1;\n    let params = [bid, uid, cmt];\n\n    try {\n      conn = await _MariaDB.default.makeConn();\n      await conn.query(_SQLs.default.board.insertCmt, params);\n      await conn.commit();\n    } catch (e) {\n      console.log(e);\n    } finally {\n      await _MariaDB.default.closeConn();\n    }\n\n    return rowData;\n  } //코멘트 삭제\n\n\n  async deleteCmt(cid, bid) {\n    let conn = null;\n    let rowData = null;\n    let params = [cid];\n\n    try {\n      conn = await _MariaDB.default.makeConn();\n      await conn.query(_SQLs.default.board.deleteCmt, params);\n      await conn.commit();\n    } catch (e) {\n      console.log(e);\n    } finally {\n      await _MariaDB.default.closeConn();\n    }\n\n    return rowData;\n  } //게시글 등록\n\n\n  async insert(data) {\n    let conn = null;\n    let rowData = 1;\n    let params = [data.title, data.userid, data.content, data.category, data.facility];\n\n    try {\n      conn = await _MariaDB.default.makeConn();\n      await conn.query(_SQLs.default.board.insert, params);\n      await conn.commit();\n    } catch (e) {\n      console.log(e);\n    } finally {\n      await _MariaDB.default.closeConn();\n    }\n\n    return rowData;\n  } //게시글 수정\n\n\n  async modify(data) {\n    let conn = null;\n    let rowData = 1;\n    let params = [data.title, data.content, data.category, data.facility, data.bid];\n\n    try {\n      conn = await _MariaDB.default.makeConn();\n      await conn.query(_SQLs.default.board.update, params);\n      await conn.commit();\n      rowData = 1;\n    } catch (e) {\n      console.log(e);\n    } finally {\n      await _MariaDB.default.closeConn();\n    }\n\n    return rowData;\n  } //게시글 삭제\n\n\n  async delete(bid) {\n    let conn = null;\n    let rowData = null;\n    let params = [bid];\n\n    try {\n      conn = await _MariaDB.default.makeConn();\n      await conn.query(_SQLs.default.board.deleteCmt2, params);\n      await conn.query(_SQLs.default.board.delete, params);\n      await conn.commit();\n      rowData = 1;\n    } catch (e) {\n      console.log(e);\n    } finally {\n      await _MariaDB.default.closeConn();\n    }\n\n    return rowData;\n  } //소셜 작성자 조회\n\n\n  async selectId(userid) {\n    let conn = null;\n    let rowData = null;\n    let params = [userid];\n\n    try {\n      conn = await _MariaDB.default.makeConn();\n      rowData = await conn.query(_SQLs.default.board.selectId, params);\n    } catch (e) {\n      console.log(e);\n    } finally {\n      await _MariaDB.default.closeConn();\n    }\n\n    return rowData;\n  }\n\n}\n\nmodule.exports = Board;","map":{"version":3,"sources":["C:/Users/fullstack/Desktop/TeamWorks/WAKAUT/next/models/board.js"],"names":["Board","select","pg","cat","note","fcname","conn","rowData","where","console","log","mariadb","makeConn","query","SQL","board","select2","e","closeConn","result","selectOne","bid","params","com","comments","updateView","commit","insertCmt","uid","cmt","deleteCmt","cid","insert","data","title","userid","content","category","facility","modify","update","delete","deleteCmt2","selectId","module","exports"],"mappings":"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","sourcesContent":["import mariadb from './MariaDB';\r\nimport SQL from './SQLs';\r\n\r\nclass Board{\r\n    //게시판 목록출력\r\n    async select(pg,cat,note,fcname){\r\n        let conn =  null;\r\n        let rowData = null;\r\n        let where ='';\r\n        (cat !='All') ? cat = `category='${cat}'` : cat='';\r\n        if(cat && note){\r\n            where = ` and ${cat} and (title like '%테스트%' or content like '%테스트%' or u.name like '%테스트%') `\r\n        }else{\r\n            console.log('일반');\r\n        }\r\n        if(fcname) where =` and facility_name = '${fcname}' `\r\n        try{\r\n            conn= await mariadb.makeConn();\r\n            rowData  = await conn.query(SQL.board.select+where+SQL.board.select2,[pg]);\r\n        }catch (e) {\r\n            console.log(e);\r\n        }finally {\r\n            await mariadb.closeConn();\r\n        }\r\n        let result={'boards': rowData};\r\n        return result;\r\n    }\r\n    //게시글 출력\r\n    async selectOne(bid){\r\n        let conn =  null;\r\n        let rowData = null;\r\n        let params = [bid];\r\n        try{\r\n            conn= await mariadb.makeConn();\r\n            rowData  = await conn.query(SQL.board.selectOne,params);\r\n            //코멘트 조회 및 추가     \r\n            rowData[0].com = await conn.query(SQL.board.comments,params);       \r\n            //조회수 증가    \r\n            await conn.query(SQL.board.updateView,params);\r\n            await conn.commit();\r\n        }catch (e) {\r\n            console.log(e);\r\n        }finally {\r\n            await mariadb.closeConn();\r\n        }\r\n        return rowData;\r\n    }\r\n    //코멘트 등록\r\n    async insertCmt(bid,uid,cmt){\r\n        let conn =  null;\r\n        let rowData = 1;\r\n        let params = [bid,uid,cmt];\r\n        try{ \r\n            conn= await mariadb.makeConn();\r\n            await conn.query(SQL.board.insertCmt,params);\r\n            await conn.commit();\r\n        }catch (e) {\r\n            console.log(e);\r\n        }finally {\r\n            await mariadb.closeConn();\r\n        }\r\n        return rowData;\r\n    }\r\n    //코멘트 삭제\r\n    async deleteCmt(cid,bid){\r\n        let conn =  null;\r\n        let rowData = null;\r\n        let params = [cid];\r\n        try{ \r\n            conn= await mariadb.makeConn();\r\n            await conn.query(SQL.board.deleteCmt,params);\r\n            await conn.commit();\r\n        }catch (e) {\r\n            console.log(e);\r\n        }finally {\r\n            await mariadb.closeConn();\r\n        }\r\n        return rowData;\r\n    }\r\n    //게시글 등록\r\n    async insert(data){\r\n        let conn =  null;\r\n        let rowData = 1;\r\n        let params = [data.title,data.userid,data.content,data.category, data.facility];\r\n        try{ \r\n            conn= await mariadb.makeConn();\r\n            await conn.query(SQL.board.insert,params);\r\n            await conn.commit();\r\n        }catch (e) {\r\n            console.log(e);\r\n        }finally {\r\n            await mariadb.closeConn();\r\n        }\r\n        return rowData;\r\n    }\r\n     //게시글 수정\r\n     async modify(data){\r\n        let conn =  null;\r\n        let rowData = 1;\r\n        let params = [data.title,data.content,data.category, data.facility,data.bid];\r\n        try{ \r\n            conn= await mariadb.makeConn();\r\n             await conn.query(SQL.board.update,params);\r\n            await conn.commit();\r\n            rowData =1;\r\n        }catch (e) {\r\n            console.log(e);\r\n        }finally {\r\n            await mariadb.closeConn();\r\n        }\r\n        return rowData;\r\n    }\r\n    //게시글 삭제\r\n    async delete(bid){\r\n        let conn =  null;\r\n        let rowData = null;\r\n        let params = [bid];\r\n        try{ \r\n            conn= await mariadb.makeConn();\r\n            await conn.query(SQL.board.deleteCmt2,params);\r\n            await conn.query(SQL.board.delete,params);\r\n            await conn.commit();\r\n            rowData =1;\r\n        }catch (e) {\r\n            console.log(e);\r\n        }finally {\r\n            await mariadb.closeConn();\r\n        }\r\n        return rowData;\r\n    }\r\n    //소셜 작성자 조회\r\n    async selectId(userid){\r\n        let conn =  null;\r\n        let rowData = null;\r\n        let params = [userid];\r\n        try{ \r\n            conn= await mariadb.makeConn();\r\n            rowData  = await conn.query(SQL.board.selectId,params);\r\n        }catch (e) {\r\n            console.log(e);\r\n        }finally {\r\n            await mariadb.closeConn();\r\n        }\r\n        return rowData;\r\n    }\r\n}\r\n\r\nmodule.exports=Board;\r\n\r\n\r\n\r\n"]},"metadata":{},"sourceType":"script"}