{"ast":null,"code":"import _toConsumableArray from \"C:/Users/pc/Desktop/\\uD559\\uC5B8/WAKAUT/WAKAUT/next/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";\nimport _regeneratorRuntime from \"C:/Users/pc/Desktop/\\uD559\\uC5B8/WAKAUT/WAKAUT/next/node_modules/@babel/runtime/regenerator\";\nimport _defineProperty from \"C:/Users/pc/Desktop/\\uD559\\uC5B8/WAKAUT/WAKAUT/next/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nimport _asyncToGenerator from \"C:/Users/pc/Desktop/\\uD559\\uC5B8/WAKAUT/WAKAUT/next/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport React from \"react\";\nvar __jsx = React.createElement;\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport { Button, Container, Form, FormSelect } from \"react-bootstrap\";\nimport List from \"../components/list\";\nimport { useEffect, useState } from \"react\";\nimport { AiTwotoneHeart } from \"react-icons/ai\";\nimport PlaceModal from \"./place_modal\";\nimport img from '../assets/workaut.png';\nimport mapicon from '../assets/map-icon.png';\nimport getLayout from \"../components/layouts/getLayout\";\nimport Modal from \"../components/modal\";\nimport { Datas } from \"../components/feutils\";\nimport { handleFacilityChange, handleSearchButtonClick, handleSearchTextChange, handleShowAll, handleSigunChange } from \"../models/Utils\";\nimport dynamic from 'next/dynamic';\nvar Map = dynamic(function () {\n  return import(\"react-kakao-maps-sdk\").then(function (module) {\n    return module.Map;\n  });\n}, {\n  ssr: false,\n  loadableGenerated: {\n    webpack: function webpack() {\n      return [require.resolveWeak(\"react-kakao-maps-sdk\")];\n    },\n    modules: [\"index.js -> \" + \"react-kakao-maps-sdk\"]\n  }\n});\nvar MapMarker = dynamic(function () {\n  return import(\"react-kakao-maps-sdk\").then(function (module) {\n    return module.MapMarker;\n  });\n}, {\n  ssr: false,\n  loadableGenerated: {\n    webpack: function webpack() {\n      return [require.resolveWeak(\"react-kakao-maps-sdk\")];\n    },\n    modules: [\"index.js -> \" + \"react-kakao-maps-sdk\"]\n  }\n});\nexport var __N_SSP = true;\nexport default function Index(_ref) {\n  var items = _ref.items,\n      word = _ref.word,\n      sessionUserid = _ref.sessionUserid,\n      fList = _ref.fList;\n  var des = '#에어로빅 #줌바 #조깅';\n\n  var _useState = useState(false),\n      lgShow = _useState[0],\n      setLgShow = _useState[1];\n\n  var _useState2 = useState(false),\n      show = _useState2[0],\n      setShow = _useState2[1];\n\n  var _useState3 = useState(\"\"),\n      selectedSigun = _useState3[0],\n      setSelectedSigun = _useState3[1];\n\n  var _useState4 = useState(\"\"),\n      selectedFacility = _useState4[0],\n      setSelectedFacility = _useState4[1];\n\n  var _useState5 = useState(\"\"),\n      searchText = _useState5[0],\n      setSearchText = _useState5[1];\n\n  var _useState6 = useState(items),\n      searchResults = _useState6[0],\n      setSearchResults = _useState6[1]; // 검색결과 저장 state\n\n\n  var _useState7 = useState(null),\n      selectedPlace = _useState7[0],\n      setSelectedPlace = _useState7[1]; // 마커 클릭시 모달 state\n\n\n  var _useState8 = useState(items.length),\n      searchCount = _useState8[0],\n      setSearchCount = _useState8[1]; // 총 몇개의 시설이 조회된건지 저장하는 state\n\n\n  var _useState9 = useState(false),\n      isButtonActive = _useState9[0],\n      setIsButtonActive = _useState9[1];\n\n  var _useState10 = useState({}),\n      bdList = _useState10[0],\n      setBDLists = _useState10[1];\n\n  var _useState11 = useState({}),\n      score = _useState11[0],\n      setScore = _useState11[1];\n\n  var _useState12 = useState(''),\n      peops = _useState12[0],\n      setPeops = _useState12[1];\n\n  var _useState13 = useState(''),\n      scs = _useState13[0],\n      setScs = _useState13[1]; // 즐겨찾기 추가 추적 state\n\n\n  var _useState14 = useState(false),\n      favoriteAdded = _useState14[0],\n      setFavoriteAdded = _useState14[1]; // List 컴포넌트 상태관리 state\n\n\n  var _useState15 = useState([]),\n      listData = _useState15[0],\n      setListData = _useState15[1];\n\n  useEffect(function () {\n    var updateListData = /*#__PURE__*/function () {\n      var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n        var fetchedFList, updatedListData;\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                _context.next = 2;\n                return Datas('/member/favorites', \"userid=\".concat(sessionUserid));\n\n              case 2:\n                fetchedFList = _context.sent;\n                // 여기에서 새로운 데이터를 listData에 업데이트\n                updatedListData = searchResults.map(function (item) {\n                  var isFavorited = fetchedFList.some(function (facility) {\n                    return facility.facility === item.FACLT_NM;\n                  });\n                  return _objectSpread(_objectSpread({}, item), {}, {\n                    isFavorited: isFavorited\n                  });\n                });\n                setListData(updatedListData);\n\n              case 5:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee);\n      }));\n\n      return function updateListData() {\n        return _ref2.apply(this, arguments);\n      };\n    }();\n\n    updateListData();\n  }, [favoriteAdded, searchResults]);\n\n  var onFavoriteAdd = function onFavoriteAdd() {\n    setFavoriteAdded(!favoriteAdded); // location.href=\"/\"\n  }; // 시군명 선택 시 시설구분명 셀렉트 태그에 표시할 options 배열 반환\n\n\n  function getFacilityOptions(sigun) {\n    var facilities = items.filter(function (item) {\n      return item.SIGUN_NM === sigun;\n    });\n\n    var facilityNames = _toConsumableArray(new Set(facilities.map(function (item) {\n      return item.FACLT_DIV_NM;\n    })));\n\n    return facilityNames.map(function (name) {\n      return __jsx(\"option\", {\n        key: name\n      }, name);\n    });\n  }\n\n  var _useState16 = useState({\n    center: {\n      lat: 37.28892227326957,\n      lng: 127.05363481102465\n    },\n    errMsg: null,\n    isLoading: true\n  }),\n      state = _useState16[0],\n      setState = _useState16[1]; // useEffect는 최초 렌더링 이후에 실행\n  // useEffect의 첫 번째 인자로 전달한 함수는 컴포넌트가 마운트된 이후에 한번 실행되며,\n  // 두 번째 인자로 전달한 배열에 지정한 값이 변경되었을 때에도 실행\n\n\n  useEffect(function () {\n    if (navigator.geolocation) {\n      // GeoLocation을 이용해서 접속 위치를 얻어옵니다\n      navigator.geolocation.getCurrentPosition(function (position) {\n        setState(function (prev) {\n          return _objectSpread(_objectSpread({}, prev), {}, {\n            center: {\n              lat: position.coords.latitude,\n              // 위도\n              lng: position.coords.longitude // 경도\n\n            },\n            isLoading: false\n          });\n        });\n      }, function (err) {\n        setState(function (prev) {\n          return _objectSpread(_objectSpread({}, prev), {}, {\n            errMsg: err.message,\n            isLoading: false\n          });\n        });\n      });\n    } else {\n      // HTML5의 GeoLocation을 사용할 수 없을때 마커 표시 위치와 인포윈도우 내용을 설정합니다\n      setState(function (prev) {\n        return _objectSpread(_objectSpread({}, prev), {}, {\n          errMsg: \"geolocation을 사용할수 없어요..\",\n          isLoading: false\n        });\n      });\n    }\n  }, []); // 게시글 목록 가지고 오기\n\n  function lists(_x) {\n    return _lists.apply(this, arguments);\n  } //별점 가져오기 \n\n\n  function _lists() {\n    _lists = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3(fcname) {\n      var boards;\n      return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n              _context3.next = 2;\n              return Datas('/board/boardlist', \"pg=5&fcname=\".concat(fcname)).then(function (r) {\n                return r;\n              });\n\n            case 2:\n              boards = _context3.sent;\n              _context3.t0 = setBDLists;\n              _context3.next = 6;\n              return boards;\n\n            case 6:\n              _context3.t1 = _context3.sent;\n              (0, _context3.t0)(_context3.t1);\n\n            case 8:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      }, _callee3);\n    }));\n    return _lists.apply(this, arguments);\n  }\n\n  var getScore = /*#__PURE__*/function () {\n    var _ref3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(fac) {\n      var sc;\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              _context2.next = 2;\n              return Datas('/member/addscore', \"facility=\".concat(fac));\n\n            case 2:\n              sc = _context2.sent;\n              _context2.t0 = setPeops;\n              _context2.next = 6;\n              return sc[0].cnt;\n\n            case 6:\n              _context2.t1 = _context2.sent;\n              (0, _context2.t0)(_context2.t1);\n              _context2.t2 = setScs;\n              _context2.next = 11;\n              return sc[0].score;\n\n            case 11:\n              _context2.t3 = _context2.sent;\n              (0, _context2.t2)(_context2.t3);\n\n            case 13:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2);\n    }));\n\n    return function getScore(_x2) {\n      return _ref3.apply(this, arguments);\n    };\n  }();\n\n  return __jsx(Container, {\n    className: \"d-flex mt-4 mb-4 index\"\n  }, __jsx(\"div\", {\n    className: \"left col-6 \"\n  }, __jsx(\"p\", null, \"\\uCD1D \", searchCount, \"\\uAC74\"), listData.map(function (item, idx) {\n    return __jsx(List, {\n      key: idx,\n      title: item.FACLT_NM,\n      malcnt: __jsx(AiTwotoneHeart, null),\n      note: item.REFINE_ROADNM_ADDR,\n      col: item.isFavorited ? \"bg-danger\" : \"bg-secondary\",\n      textClick: function textClick() {\n        setSelectedPlace(item);\n        var lat = parseFloat(item.REFINE_WGS84_LAT);\n        var lng = parseFloat(item.REFINE_WGS84_LOGT);\n        setState(function (prev) {\n          return _objectSpread(_objectSpread({}, prev), {}, {\n            center: {\n              lat: lat,\n              lng: lng\n            }\n          });\n        });\n        lists(item.FACLT_NM).then(getScore(item.FACLT_NM)).then(setLgShow(true));\n      }\n    });\n  })), __jsx(\"div\", {\n    className: \"right col-6 ms-4\"\n  }, word ? __jsx(Button, {\n    className: \"showAll-btn mb-2\",\n    variant: \"outline-success\",\n    onClick: handleShowAll\n  }, \"\\uC804\\uCCB4 \\uC2DC\\uC124\\uBCF4\\uAE30\") : false, __jsx(Form, {\n    className: \"d-flex mb-2\"\n  }, __jsx(FormSelect, {\n    value: selectedSigun,\n    onChange: function onChange(e) {\n      return handleSigunChange(e, setSelectedSigun, setSelectedFacility, setSearchText, items, setState, setSearchResults, setSearchCount);\n    }\n  }, __jsx(\"option\", {\n    value: \"\"\n  }, \"\\uC2DC\\uAD70\"), _toConsumableArray(new Set(items.map(function (item) {\n    return item.SIGUN_NM;\n  }))).map(function (sigun) {\n    return __jsx(\"option\", {\n      key: sigun,\n      value: sigun\n    }, sigun);\n  })), selectedSigun ? __jsx(FormSelect, {\n    value: selectedFacility,\n    onChange: function onChange(e) {\n      return handleFacilityChange(e, setSelectedFacility);\n    }\n  }, __jsx(\"option\", {\n    value: \"\"\n  }, \"\\uC2DC\\uC124\\uAD6C\\uBD84\\uBA85\"), getFacilityOptions(selectedSigun)) : __jsx(FormSelect, null, __jsx(\"option\", null, \"\\uC2DC\\uC124\\uAD6C\\uBD84\\uBA85\")), __jsx(Form.Control, {\n    type: \"text\",\n    placeholder: \"\\uC5B4\\uB514\\uC11C \\uC6B4\\uB3D9\\uD560\\uAE4C\\uC694?\",\n    value: searchText,\n    onChange: function onChange(e) {\n      return handleSearchTextChange(e, setSearchText, setSearchResults, setSearchCount, setIsButtonActive);\n    }\n  }), __jsx(Button, {\n    className: \"facility-btn\",\n    variant: \"outline-success\",\n    active: isButtonActive,\n    onClick: function onClick() {\n      return handleSearchButtonClick(items, selectedSigun, selectedFacility, searchText, setShow, setSearchResults, setSearchCount);\n    }\n  }, \"Search\")), __jsx(Map, {\n    center: state.center,\n    style: {\n      width: \"100%\",\n      height: \"800px\"\n    },\n    level: 3\n  }, (!state.isLoading ? searchResults : []).map(function (item) {\n    return __jsx(MapMarker, {\n      key: item.FACLT_NM,\n      position: {\n        lat: item.REFINE_WGS84_LAT,\n        lng: item.REFINE_WGS84_LOGT\n      },\n      onClick: function onClick() {\n        setSelectedPlace(item);\n        setLgShow(true);\n      },\n      image: {\n        src: \"\".concat(mapicon),\n        size: {\n          width: 30,\n          height: 30\n        },\n        options: {\n          offset: {\n            x: 27,\n            y: 69\n          }\n        }\n      }\n    });\n  }))), __jsx(PlaceModal, {\n    size: \"lg\",\n    lgShow: lgShow,\n    setLgShow: setLgShow,\n    score: scs,\n    setScs: setScs,\n    peops: peops,\n    setPeops: setPeops,\n    title: selectedPlace ? selectedPlace.FACLT_NM : \"\",\n    addr: selectedPlace ? selectedPlace.REFINE_ROADNM_ADDR : \"\",\n    contact: selectedPlace ? selectedPlace.CONTCT_NO : \"\",\n    des: des,\n    img: img,\n    lat: selectedPlace ? selectedPlace.REFINE_WGS84_LAT : null,\n    lng: selectedPlace ? selectedPlace.REFINE_WGS84_LOGT : null,\n    bdList: bdList,\n    userid: sessionUserid,\n    onFavoriteAdd: onFavoriteAdd\n  }), __jsx(Modal, {\n    title: \"\\uC54C\\uB9BC\",\n    \"class\": \"searchModal\",\n    size: \"sm\",\n    lgShow: show,\n    setLgShow: setShow,\n    children: \"\\uD574\\uB2F9\\uD558\\uB294 \\uC2DC\\uC124\\uC774 \\uC5C6\\uC2B5\\uB2C8\\uB2E4.\"\n  }));\n}\ngetLayout(Index, {\n  title: '주변에서 운동해요! WAKAUT!',\n  description: '신개념 운동 플랫폼 워크아웃!'\n});","map":null,"metadata":{},"sourceType":"module"}